<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Valentines — Create a Personal Link</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; padding:20px; max-width:720px; margin: auto; color:#222; }
    .card { border:1px solid #eee; padding:18px; border-radius:10px; margin-top:18px; text-align:center; }
    .hero { text-align:center; margin-top:10px; }
    .buy {
      display:inline-flex;
      align-items:baseline;
      gap:8px;
      background:#e83e8c;
      color:white;
      padding:12px 20px;
      border-radius:8px;
      text-decoration:none;
      font-weight:700;
      border:0;
      cursor:pointer;
      font-size:16px;
    }
    .price-now { color:#fff; font-size:18px; font-weight:800; }
    .price-old {
      color:rgba(255,255,255,0.9);
      font-size:13px;
      font-weight:600;
      opacity:0.85;
      text-decoration:line-through;
      margin-left:6px;
    }
    .note { color:#666; font-size:14px; margin-top:12px; }
    img.demo { max-width:100%; border-radius:8px; margin-top:12px; }
    .status { margin-top:12px; color:#444; font-size:14px; }
    .muted { color:#888; font-size:13px; margin-top:10px; }
  </style>
</head>
<body>
  <div class="hero">
    <h1>Make a Personalized Valentine Link</h1>
    <p>Create a small, shareable Valentine with images, music and a message.</p>
  </div>

  <div class="card">
    <h3>How it works</h3>
    <ol style="text-align:left; max-width:520px; margin: 10px auto;">
      <li>Click Buy → complete payment</li>
      <li>You'll receive a claim link to open the Setup page</li>
      <li>Create the Valentine (edits allowed for 2 hours)</li>
      <li>Get a shareable link to send to someone special</li>
    </ol>

    <img class="demo" src="https://via.placeholder.com/600x280?text=Valentine+Demo" alt="Demo">

    <p style="margin-top:12px">
      <button id="buyBtn" class="buy" aria-live="polite" aria-busy="false">
        <span class="price-now">Buy now — ₹200</span>
        <span class="price-old">₹250</span>
      </button>
    </p>

    <div id="status" class="status" aria-live="polite"></div>

    <p class="note">This is a demo flow. Setup access is valid for 2 hours after purchase.</p>
    <p class="muted">Note: This page uses the server to create a fresh Razorpay payment link (recommended). If you prefer a static dashboard link, replace the button with a direct anchor.</p>
  </div>

  <p style="text-align:center; margin-top:18px; color:#666; font-size:13px;">
    After purchase the server will generate a secure claim link for you to open the Setup page.
  </p>

<script>
(function () {
  const buyBtn = document.getElementById('buyBtn');
  const statusEl = document.getElementById('status');
  const originalHtml = buyBtn.innerHTML;

  function setStatus(text, isError) {
    statusEl.textContent = text;
    statusEl.style.color = isError ? '#b00020' : '#444';
  }

  buyBtn.addEventListener('click', async function () {
    buyBtn.disabled = true;
    buyBtn.setAttribute('aria-busy', 'true');
    buyBtn.innerHTML = 'Creating payment...';
    setStatus('');

    try {
      // Request server to create a fresh payment link for ₹200
      const resp = await fetch('/create-payment-link', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount: 200 })
      });

      const data = await resp.json().catch(() => ({}));

      if (!resp.ok) {
        console.error('create-payment-link failed', data);
        setStatus('Failed to create payment link. Try again or check console.', true);
        // restore UI
        buyBtn.disabled = false;
        buyBtn.setAttribute('aria-busy', 'false');
        buyBtn.innerHTML = originalHtml;
        return;
      }

      // Razorpay API returns short_url or short_link; accept common variants
      const url = data.short_url || data.shortLink || data.shortUrl || data.short_link || data.short_link_url;
      if (!url) {
        console.error('create-payment-link response missing short_url', data);
        setStatus('Payment link created but server did not return a short_url. Check logs.', true);
        buyBtn.disabled = false;
        buyBtn.setAttribute('aria-busy', 'false');
        buyBtn.innerHTML = originalHtml;
        return;
      }

      // Redirect user to the Razorpay payment page (same tab so callback works)
      window.location.href = url;

    } catch (err) {
      console.error('Buy error', err);
      setStatus('Network error creating payment link. Try again.', true);
      buyBtn.disabled = false;
      buyBtn.setAttribute('aria-busy', 'false');
      buyBtn.innerHTML = originalHtml;
    }
  });
})();
</script>
</body>
</html><!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Valentines — Create a Personal Link</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; padding:20px; max-width:720px; margin: auto; color:#222; }
    .card { border:1px solid #eee; padding:18px; border-radius:10px; margin-top:18px; text-align:center; }
    .hero { text-align:center; margin-top:10px; }
    .buy { display:inline-flex; align-items:baseline; gap:8px; background:#e83e8c; color:white; padding:12px 20px; border-radius:8px; text-decoration:none; font-weight:700; border:0; cursor:pointer; font-size:16px; }
    .price-now { color:#fff; font-size:18px; font-weight:800; }
    .price-old { color:rgba(255,255,255,0.85); font-size:13px; font-weight:600; opacity:0.85; margin-left:6px; text-decoration:line-through; }
    .note { color:#666; font-size:14px; margin-top:12px; }
    img.demo { max-width:100%; border-radius:8px; margin-top:12px; }
    .status { margin-top:12px; color:#444; font-size:14px; }
  </style>
</head>
<body>
  <div class="hero">
    <h1>Make a Personalized Valentine Link</h1>
    <p>Create a small, shareable Valentine with images, music and a message.</p>
  </div>

  <div class="card">
    <h3>How it works</h3>
    <ol style="text-align:left; max-width:520px; margin: 10px auto;">
      <li>Click Buy → complete payment</li>
      <li>You'll receive a claim link to open the Setup page</li>
      <li>Create the Valentine (edits allowed for 2 hours)</li>
      <li>Get a shareable link to send to someone special</li>
    </ol>

    <img class="demo" src="https://via.placeholder.com/600x280?text=Valentine+Demo" alt="Demo">

    <p style="margin-top:12px">
      <button id="buyBtn" class="buy" aria-live="polite" aria-busy="false">
        <span class="price-now">Buy now — ₹200</span>
        <span class="price-old">₹250</span>
      </button>
    </p>

    <div id="status" class="status" aria-live="polite"></div>

    <p class="note">This is a demo flow. Setup access is valid for 2 hours after purchase.</p>
  </div>

  <p style="text-align:center; margin-top:18px; color:#666; font-size:13px;">
    After purchase the server will generate a secure claim link for you to open the Setup page.
  </p>

<script>
(function () {
  // <-- Replace this with your Razorpay short link.
  // I set it to the URL you previously mentioned.
  const PAYMENT_LINK = 'https://rzp.io/rzp/F7sFPVIa';

  const buyBtn = document.getElementById('buyBtn');
  const statusEl = document.getElementById('status');
  const originalHtml = buyBtn.innerHTML;

  function setStatus(text, isError) {
    statusEl.textContent = text;
    statusEl.style.color = isError ? '#b00020' : '#444';
  }

  buyBtn.addEventListener('click', function () {
    // treat as not-configured only if empty or still the obvious placeholder
    if (!PAYMENT_LINK || PAYMENT_LINK.trim() === '' || PAYMENT_LINK.includes('your_short_url_here')) {
      setStatus('Payment link not configured. Replace PAYMENT_LINK in the script with your Razorpay short_url.', true);
      return;
    }

    buyBtn.disabled = true;
    buyBtn.setAttribute('aria-busy', 'true');
    buyBtn.innerHTML = 'Opening payment...';

    // Navigate same-tab so Razorpay can redirect back to /claim-return after payment
    try {
      window.location.href = PAYMENT_LINK;
    } catch (err) {
      console.error('Error redirecting to payment link', err);
      setStatus('Failed to open payment link. Try again.', true);
      // restore UI
      buyBtn.disabled = false;
      buyBtn.setAttribute('aria-busy', 'false');
      buyBtn.innerHTML = originalHtml;
    }
  });
})();
</script>
</body>
</html>
